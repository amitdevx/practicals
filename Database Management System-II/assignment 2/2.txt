Assignment 2 - Stored Functions
Stored functions are user defined functions, that are created using the CREATE FUNCTION statement.
The functions, thus created, are called stored functions because they are stored as database objects
within the PostgreSQL database. The CREATE FUNCTION command names the new function, states
its arguments and return type.
Creating a stored function:
CREATE FUNCTION identifier (arguments) RETURNS type AS’
`DECLARE
Variable–declarations; [……] BEGIN
Statement; [ ...........]
END ;
‘ LANGUAGE ‘plpgsql’;
Argument variables:
PL/pgSQL functions can accept argument variables of different types. Function arguments allow a
user to pass information into a function, that the function may need.
Each function argument that is received by a function is incrementally assigned to an identifier that
begins with the dollar ($) sign and is labeled with the argument number. Thus the identifier
$1 is used for the first argument, $2 is used for the second argument and so on an so forth. PL/pgSQL
allows us to create variable aliases. Aliases are created using the ALIAS keyword and it gives us
the ability to provide an alternate variable to use when referencing argument variables. All aliases
should be declared within the DECLARE section of a block before they are used.
Returning variables:
PL/pgSQL functions must return a value that matches the data type specified as the return type during
the function definition. Values are returned from a function using the RETURN statement.
Attributes:
PL/pgSQL provides variable attributes that basically assists or helps the database programmer , when
working with database objects. These attributes are %TYPE and %ROWTYPE.
The TYPE attribute : Used to declare a variable with the data type of a referenced database object
( a table column).
Syntax :Variable_nametable_name.column_name%TYPE ;
The %ROWTYPEattribute : Used to declare a PL/pgSQL record variable to have the same
structure as the rows in a table , that we specify in the function block.
Syntax :Variable_nametable_name%ROWTYPE;
Controlling Program Flow:
Most programming languages provides different ways of controlling the flow of execution, within a
program. PL/pgSQL also provides various statements using which a programmer can control the way
actions will be executed within a PL/pgSQL function code. PL/pgSQL provides
33conditional statements and control loops for the same.
1
Statement
The IF/THEN statementSyntax
If < Condition> Then
statement;
[..]
Else
Statement; [..]
End if;
Nested If-else ifIf Then
Statement; [..]
Else if Then
Statement;
[….]
Else if Then
Statement; [……]
Else Statement;
[….]
End if;
End if;
End if;
LoopsLOOP
Statement;
[………]
EXIT [label] WHEN
END LOOP;
While Condition
Loop
Statement; […….]
End loop;
While Loop
For LoopFor Loop–Index In {Reverse} expression1 ........ expression2
Loop
Statement; [ .. ]
End loop;
For Loop (iterate through a
query resultset)For {record_variable | %rowtype_variable } IN
select_statement
LOOP
Statement; [ ... ]
END LOOP
34NOTE: Solve any three sets from the Following:
SET A
Using If.-Then-else,case,for,while and unconditional loops
1. Find minimum and maximum from two numbers
2. Check the number is positive, negative or zero.
3. Find maximum and minimum from three numbers
4. Find number is even or odd
5. Find sum of first 20 numbers (using unconditional loop)
6. Display all even numbers from 1 to 50.
7. Find sum and average of first n numbers using conditional loop(while)
8. Count odd numbers from given range (m to n) (for)
9. Search the given number is in given range.
10. Display a number in word (Using Case) and loop.
SET B
Bank database
Consider the following database maintained by a Bank. The Bank maintains information about its
branches, customers and their loan applications.
Following are the tables:
branch (bid integer, brname char (30), brcity char (10))
customer (cno integer, cname char (20), caddr char (35), city char(20))
loan_application (lno integer, lamtrequired money, lamtapproved money, l_date date)
The relationship is as follows: branch, customer, loan_application are related with ternary
relationship. TERNARY (bid integer, cno integer, lno integer).
a) Write a function that returns the total number of customers of a particular branch.(Accept
branch name as input parameter.)
b) Write a function to find the minimum loan amount approved.
c) Create a function which returns the total number of customers who have applied for a loan
more than Rs.200000. (Accept loan amount as input parameter)
SET C
Student- Teacher database
Consider the following database maintained by a school. The school maintains information about
students and the teachers. It also gives information of the subject taught by the teacher.
Following are the tables:
student (sno integer, s_name char(30), s_class char(10), s_addr char(50))
teacher (tno integer, t_name char (20), qualification char (15), experience integer)
The relationship is as follows: STUDENT-TEACHER: Many to Many with descriptive attribute
SUBJECT.
a) Write a function to find name of the most experienced teacher for “Computer”.
35b) Write a function to find the teacher teaching maximum number of subjects.
c) Write a function to find the number of teachers having qualification “NET”.
SET D
Project – Employee Database
Consider the following database
Project (pno int, pname char (30), ptype char (20), duration int)
Employee (empno int, ename char (20), joining_date date)
The relationship between Project and Employee is many to many with descriptive attribute start_date.
Create the above database in PostGreSQL and insert sufficient records.
Execute any two of the following using PL/pgSQL
a. Write a stored function to accept project type as an input and display all project names of
that type.
b. Write a function which accepts employee name and prints the details of the project which
the employee works on.
c. Write a function to accept project name as input and returns the number of employees
working on the project.
SET E
Student - Subject Database
Consider the following database
Student (roll_no integer, name varchar(30), address varchar(50), class varchar(10)) Subject
(scode varchar(10), subject_name varchar(20))
Student-Subject are related with Many to Many relationship with attributes
marks_scored. Create the above database in PostGreSQL and insert sufficient records.
a. Write a function which will accept the name and print all the details of that student.
b. Write a function to accept student roll_no as input and displays details of that student.
c. Write a stored function using cursors, to accept class from the user and display the details of the
students of that class.
